-- [[ LOCAL SCRIPT: PadRainbowClient ]]
-- Purpose: Finds pads tagged with "IsRainbow" and cycles their colors smoothly.
-- Location: StarterPlayerScripts

local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

-- ‚öôÔ∏è CONFIGURATION
local RAINBOW_SPEED = 0.5   -- How fast the colors switch (Lower = Slower)
local SATURATION = 1        -- 1 = Deep Neon, 0.5 = Pastel
local VALUE = 1             -- 1 = Bright, 0.5 = Dark

-- üîç TRACKING TABLE
local rainbowParts = {}

-- üåà 1. THE COLOR ANIMATION LOOP
RunService.Heartbeat:Connect(function()
	-- Calculate the current rainbow color based on time
	local hue = (tick() * RAINBOW_SPEED) % 1
	local rainbowColor = Color3.fromHSV(hue, SATURATION, VALUE)

	-- Apply to all tracked parts
	for part, _ in pairs(rainbowParts) do
		if part and part.Parent and part:GetAttribute("IsRainbow") then
			part.Color = rainbowColor
		else
			-- Stop tracking if part is destroyed or attribute removed
			rainbowParts[part] = nil
		end
	end
end)

-- üõ†Ô∏è 2. TRACKING FUNCTIONS
local function StartAnimating(part)
	if part:IsA("BasePart") then
		rainbowParts[part] = true
	end
end

local function StopAnimating(part)
	rainbowParts[part] = nil
end

-- üïµÔ∏è 3. SCANNER (Finds existing pads)
local function ScanForRainbows()
	for _, tycoon in pairs(Workspace:WaitForChild("Tycoons"):GetChildren()) do
		local pads = tycoon:FindFirstChild("Pads")
		if pads then
			for _, padModel in pairs(pads:GetChildren()) do
				for _, part in pairs(padModel:GetDescendants()) do
					-- Check if the Server tagged it as Rainbow
					if part:IsA("BasePart") and part:GetAttribute("IsRainbow") then
						StartAnimating(part)
					end
				end
			end
		end
	end
end

-- üì° 4. LIVE LISTENERS (Detects when you Equip/Unequip)
-- Watch for new parts (Buying items)
Workspace.DescendantAdded:Connect(function(descendant)
	if descendant:IsA("BasePart") then
		-- Wait a tiny bit for attributes to replicate
		task.wait(0.1) 
		if descendant:GetAttribute("IsRainbow") then
			StartAnimating(descendant)
		end
	end
end)

-- Watch for Attribute changes (Equipping skins)
game.DescendantAttributeChanged:Connect(function(descendant, attr)
	if attr == "IsRainbow" and descendant:IsA("BasePart") then
		if descendant:GetAttribute("IsRainbow") then
			StartAnimating(descendant) -- Turned ON
		else
			StopAnimating(descendant)  -- Turned OFF
		end
	end
end)

-- Start immediately
ScanForRainbows()
